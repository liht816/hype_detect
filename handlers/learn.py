"""
–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ–±—É—á–µ–Ω–∏—è
"""
from telegram import Update
from telegram.ext import ContextTypes, CallbackQueryHandler

from utils.keyboards import learn_keyboard, back_to_menu_keyboard


LESSONS = {
    "pnd": """
üìñ *–ß—Ç–æ —Ç–∞–∫–æ–µ Pump & Dump?*

*Pump & Dump (P&D)* ‚Äî —Å—Ö–µ–º–∞ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏:

1Ô∏è‚É£ *Pump (–Ω–∞–∫–∞—á–∫–∞):*
–°–∫—É–ø–∞—é—Ç –º–æ–Ω–µ—Ç—É –¥—ë—à–µ–≤–æ, —Å–æ–∑–¥–∞—é—Ç —Ö–∞–π–ø

2Ô∏è‚É£ *Dump (—Å–±—Ä–æ—Å):*
–ü—Ä–æ–¥–∞—é—Ç –Ω–∞ –ø–∏–∫–µ, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–µ—Ä—è—é—Ç –¥–µ–Ω—å–≥–∏

*–ö–∞–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å:*
‚Ä¢ üöÄ –†–µ–∑–∫–∏–π —Ä–æ—Å—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–π
‚Ä¢ ü§ñ –ú–Ω–æ–≥–æ –±–æ—Ç–æ–≤-–∫–æ–º–º–µ–Ω—Ç–∞—Ç–æ—Ä–æ–≤
‚Ä¢ üí∞ –ù–∏–∑–∫–∞—è –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è
‚Ä¢ üìà –†–æ—Å—Ç –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã

*–ó–∞—â–∏—Ç–∞:*
‚Ä¢ –ù–µ –ø–æ–∫—É–ø–∞–π –Ω–∞ —Ö–∞–π–ø–µ
‚Ä¢ –ü—Ä–æ–≤–µ—Ä—è–π –∏—Å—Ç–æ—Ä–∏—é
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π –î–µ—Ç–µ–∫—Ç–æ—Ä –•–∞–π–ø–∞! üòâ
""",
    
    "hype": """
üéØ *–ö–∞–∫ —á–∏—Ç–∞—Ç—å —Ö–∞–π–ø-—Å–∫–æ—Ä?*

üü¢ *0-20 ‚Äî –û—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–π —Ä–æ—Å—Ç*
–ù–µ—Ç –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π, –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏–∑—É—á–∞—Ç—å

üü° *20-40 ‚Äî –£–º–µ—Ä–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–µ—Å*
–ú–æ–Ω–µ—Ç–∞ –Ω–∞ —Ä–∞–¥–∞—Ä–µ, –Ω–æ –±–µ–∑ –∞–∂–∏–æ—Ç–∞–∂–∞

üü† *40-60 ‚Äî –ü–æ–≤—ã—à–µ–Ω–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ*
–ë—É–¥—å –≤–Ω–∏–º–∞—Ç–µ–ª–µ–Ω!

üî¥ *60-80 ‚Äî –Ø–≤–Ω—ã–π —Ö–∞–π–ø*
–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ P&D!

üíÄ *80-100 ‚Äî DANGER ZONE*
–ù–µ –≤—Ö–æ–¥–∏! –û—á–µ–Ω—å –æ–ø–∞—Å–Ω–æ!

*–ü–æ–º–Ω–∏:*
–í—ã—Å–æ–∫–∏–π —Ö–∞–π–ø ‚â† —Ö–æ—Ä–æ—à–∞—è –º–æ–Ω–µ—Ç–∞
–ù–∏–∑–∫–∏–π —Ö–∞–π–ø ‚â† –ø–ª–æ—Ö–∞—è –º–æ–Ω–µ—Ç–∞
""",
    
    "psychology": """
üß† *–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è —Ç—Ä–µ–π–¥–∏–Ω–≥–∞*

*–ì–ª–∞–≤–Ω—ã–µ –≤—Ä–∞–≥–∏:*

üò± *FOMO* ‚Äî —Å—Ç—Ä–∞—Ö —É–ø—É—Å—Ç–∏—Ç—å
_"–í—Å–µ –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏, –∞ —è –Ω–µ—Ç!"_
‚Üí –í—Å–µ–≥–¥–∞ –µ—Å—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —à–∞–Ω—Å

ü§ë *–ñ–∞–¥–Ω–æ—Å—Ç—å*
_"–ü–æ–¥–æ–∂–¥—É –µ—â—ë, –±—É–¥–µ—Ç –±–æ–ª—å—à–µ!"_
‚Üí –§–∏–∫—Å–∏—Ä—É–π –ø—Ä–∏–±—ã–ª—å —á–∞—Å—Ç—è–º–∏

üò§ *–¢–∏–ª—å—Ç*
_"–û—Ç—ã–≥—Ä–∞—é—Å—å!"_
‚Üí –ü–æ—Å–ª–µ —É–±—ã—Ç–∫–∞ ‚Äî –ø–µ—Ä–µ—Ä—ã–≤

*–ü—Ä–∞–≤–∏–ª–∞:*
‚úÖ –ü–ª–∞–Ω –î–û –≤—Ö–æ–¥–∞
‚úÖ –ù–µ —Ç–æ—Ä–≥—É–π –Ω–∞ —ç–º–æ—Ü–∏—è—Ö
‚úÖ –í–µ–¥–∏ –¥–Ω–µ–≤–Ω–∏–∫
‚úÖ –°–ø–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
‚úÖ –ù–µ —Ä–∏—Å–∫—É–π –ø–æ—Å–ª–µ–¥–Ω–∏–º
""",
    
    "checklist": """
‚úÖ *–ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –ø–æ–∫—É–ø–∫–æ–π*

*–ü—Ä–æ–µ–∫—Ç:*
‚òê –ü–æ–Ω–∏–º–∞—é —á—Ç–æ –¥–µ–ª–∞–µ—Ç
‚òê –ï—Å—Ç—å —Ä–∞–±–æ—Ç–∞—é—â–∏–π –ø—Ä–æ–¥—É–∫—Ç
‚òê –ö–æ–º–∞–Ω–¥–∞ –ø—É–±–ª–∏—á–Ω–∞
‚òê GitHub –∞–∫—Ç–∏–≤–µ–Ω

*Red Flags:*
‚òê –ù–µ –ø–æ—Ö–æ–∂–µ –Ω–∞ P&D
‚òê –ö–æ–Ω—Ç—Ä–∞–∫—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω
‚òê –ï—Å—Ç—å –∞—É–¥–∏—Ç
‚òê –ù–µ—Ç –∞–Ω–æ–Ω–∏–º–æ–≤

*–†—ã–Ω–æ–∫:*
‚òê –•–∞–π–ø-—Å–∫–æ—Ä –≤ –Ω–æ—Ä–º–µ
‚òê –ö–∏—Ç—ã –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç
‚òê –ù–µ –Ω–∞ ATH

*–õ–∏—á–Ω–æ–µ:*
‚òê –ù–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–Ω—å–≥–∏
‚òê –ì–æ—Ç–æ–≤ –ø–æ—Ç–µ—Ä—è—Ç—å
‚òê –ï—Å—Ç—å –ø–ª–∞–Ω –≤—ã—Ö–æ–¥–∞
‚òê –Ø —Å–ø–æ–∫–æ–µ–Ω
""",
    
    "glossary": """
üìö *–°–ª–æ–≤–∞—Ä—å —Ç—Ä–µ–π–¥–µ—Ä–∞*

*ATH* ‚Äî –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –º–∞–∫—Å–∏–º—É–º
*DYOR* ‚Äî —Å–≤–æ—ë –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
*FOMO* ‚Äî —Å—Ç—Ä–∞—Ö —É–ø—É—Å—Ç–∏—Ç—å
*FUD* ‚Äî —Å—Ç—Ä–∞—Ö –∏ —Å–æ–º–Ω–µ–Ω–∏—è
*HODL* ‚Äî –¥–µ—Ä–∂–∞—Ç—å
*Moon* ‚Äî —Ä–µ–∑–∫–∏–π —Ä–æ—Å—Ç
*Pump* ‚Äî –Ω–∞–∫–∞—á–∫–∞ —Ü–µ–Ω—ã
*Dump* ‚Äî —Å–±—Ä–æ—Å
*Rug Pull* ‚Äî —Å–∫–∞–º
*Whale* ‚Äî –∫–∏—Ç (–∫—Ä—É–ø–Ω—ã–π –∏–≥—Ä–æ–∫)
*Rekt* ‚Äî –ø–æ—Ç–µ—Ä—è–ª –≤—Å—ë
*Gas* ‚Äî –∫–æ–º–∏—Å—Å–∏—è
*DEX* ‚Äî –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –±–∏—Ä–∂–∞
*CEX* ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –±–∏—Ä–∂–∞
*APY* ‚Äî –≥–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
""",
}


async def learn_menu_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ú–µ–Ω—é –æ–±—É—á–µ–Ω–∏—è"""
    query = update.callback_query
    await query.answer()
    
    await query.edit_message_text(
        "üéì *–û–±—É—á–µ–Ω–∏–µ*\n\n"
        "–ò–∑—É—á–∏ –æ—Å–Ω–æ–≤—ã, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –¥–µ–Ω—å–≥–∏!\n\n"
        "–í—ã–±–µ—Ä–∏ —Ç–µ–º—É:",
        parse_mode="Markdown",
        reply_markup=learn_keyboard()
    )


async def learn_topic_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü–æ–∫–∞–∑ —É—Ä–æ–∫–∞"""
    query = update.callback_query
    await query.answer()
    
    topic = query.data.split(":")[1]
    
    if topic == "simulator":
        await query.edit_message_text(
            "üéÆ *–°–∏–º—É–ª—è—Ç–æ—Ä P&D*\n\n"
            "–¢—Ä–µ–Ω–∏—Ä—É–π –Ω–∞–≤—ã–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è!\n\n"
            "üîú _–°–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ_\n\n"
            "–ü–æ–∫–∞ –∏–∑—É—á–∏ —Ç–µ–æ—Ä–∏—é –≤ —Ä–∞–∑–¥–µ–ª–µ\n"
            "¬´–ß—Ç–æ —Ç–∞–∫–æ–µ P&D¬ª",
            parse_mode="Markdown",
            reply_markup=learn_keyboard()
        )
        return
    
    text = LESSONS.get(topic, "üìö –¢–µ–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
    
    await query.edit_message_text(
        text,
        parse_mode="Markdown",
        reply_markup=learn_keyboard()
    )


def register_learn_handlers(app):
    """–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤"""
    app.add_handler(CallbackQueryHandler(
        learn_menu_callback,
        pattern=r"^menu:learn$"
    ))
    app.add_handler(CallbackQueryHandler(
        learn_topic_callback,
        pattern=r"^learn:"
    ))